<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>150: Impedance calculation · VoronoiFVM.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>VoronoiFVM.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../changes/">Changes</a></li><li><a class="toctext" href="../../method/">The Voronoi finite volume method</a></li><li><span class="toctext">API Documentation</span><ul><li><a class="toctext" href="../../grid/">Grid</a></li><li><a class="toctext" href="../../physics/">Physics</a></li><li><a class="toctext" href="../../system/">System</a></li><li><a class="toctext" href="../../allindex/">Index</a></li></ul></li><li><span class="toctext">Examples</span><ul><li><a class="toctext" href="../Example101_Laplace1D/">101: 1D Laplace equation</a></li><li><a class="toctext" href="../Example105_NonlinearPoisson1D/">105: 1D Nonlinear Poisson equation</a></li><li><a class="toctext" href="../Example110_NonlinearPoisson1D_TwoSpecies/">110: 1D Nonlinear Poisson equation with two species</a></li><li><a class="toctext" href="../Example115_NonlinearPoisson1D_BoundarySpecies/">-</a></li><li><a class="toctext" href="../Example120_ThreeRegions1D/">120: Differing species sets in regions, 1D</a></li><li><a class="toctext" href="../Example125_TestFunctions1D/">125: Terminal flux calculation via test functions</a></li><li class="current"><a class="toctext" href>150: Impedance calculation</a><ul class="internal"></ul></li><li><a class="toctext" href="../Example160_UnipolarDriftDiffusion1D/">160: Unipolar degenerate drift-diffusion</a></li><li><a class="toctext" href="../Example205_NonlinearPoisson2D/">205: 2D Nonlinear Poisson equation</a></li><li><a class="toctext" href="../Example210_NonlinearPoisson2D_Reaction/">210: 2D Nonlinear Poisson with reaction</a></li><li><a class="toctext" href="../Example215_NonlinearPoisson2D_BoundaryReaction/">215: 2D Nonlinear Poisson with boundary reaction</a></li><li><a class="toctext" href="../Example220_NonlinearPoisson2D_BoundarySpecies/">220: 2D Nonlinear Poisson with boundary reaction and boundary species</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Examples</li><li><a href>150: Impedance calculation</a></li></ul><a class="edit-page" href="https://github.com/j-fu/VoronoiFVM.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>150: Impedance calculation</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id=":-Impedance-calculation-1" href="#:-Impedance-calculation-1">150: Impedance calculation</a></h1><p>Impedance calculation for</p><p>C u<em>t - (D u</em>x)_x + Ru = 0   in (0,1)      u(0,t)=1 + exp(iωt)      u(1,t)=0</p><p>Measurement: I(t)= D u_x(1,t)</p><p>Steady state:</p><ul><li>(D u0<em>x)</em>x + Ru0 = 0</li></ul><p>u0(0,t)=1    u0(1,t)=0</p><p>Small signal ansatz for ω</p><p>u(x,t)= u0(x)+ ua(x) exp(iωt)</p><p>iωC ua - (D ua<em>x)</em>x + R u_a =0      ua(0)=1      ua(1)=0</p><pre><code class="language-julia">module Example150_Impedance1D

using Printf
using VoronoiFVM

if isinteractive()
    using Plots
end</code></pre><p>Structure containing  userdata information</p><pre><code class="language-julia">mutable struct Data  &lt;: VoronoiFVM.AbstractData
    D::Real
    C::Real
    R::Real
    Data()=new()
end


function main(;nref=0,doplot=false,verbose=false)
    L=1.0</code></pre><p>Create array which is refined close to 0</p><pre><code class="language-julia">    h0=0.1/2.0^nref
    h1=0.5/2.0^nref
    X=VoronoiFVM.geomspace(0.0,L,h0,h1)</code></pre><p>Create discretitzation grid</p><pre><code class="language-julia">    grid=VoronoiFVM.Grid(X)</code></pre><p>Create and fill data</p><pre><code class="language-julia">    data=Data()
    data.R=1
    data.D=1
    data.C=2</code></pre><p>Declare constitutive functions</p><pre><code class="language-julia">    flux=function(f,u,edge,data)
        f[1]=data.D*(u[1]-u[2])
    end

    storage=function(f,u,node,data)
        f[1]=data.C*u[1]
    end

    reaction=function(f,u,node,data)
        f[1]=data.R*u[1]
    end</code></pre><p>Create physics struct</p><pre><code class="language-julia">    physics=VoronoiFVM.Physics(data=data,
                               flux=flux,
                               storage=storage,
                               reaction=reaction
                               )</code></pre><p>Create discrete system and enabe species</p><pre><code class="language-julia">    sys=VoronoiFVM.DenseSystem(grid,physics)
    enable_species!(sys,1,[1])</code></pre><p>Create test functions for current measurement</p><pre><code class="language-julia">    factory=VoronoiFVM.TestFunctionFactory(sys)
    tf0=testfunction(factory,[2],[1])
    tfL=testfunction(factory,[1],[2])</code></pre><p>Solve steady state problem</p><pre><code class="language-julia">    sys.boundary_values[1,1]=1.0
    sys.boundary_values[1,2]=0

    sys.boundary_factors[1,1]=VoronoiFVM.Dirichlet
    sys.boundary_factors[1,2]=VoronoiFVM.Dirichlet

    inival=unknowns(sys)
    steadystate=unknowns(sys)
    inival.=0.0
    solve!(steadystate,inival,sys)</code></pre><p>Create Impeadancs system from steady state</p><pre><code class="language-julia">    excited_spec=1
    excited_bc=1
    isys=VoronoiFVM.ImpedanceSystem(sys,steadystate,excited_spec, excited_bc)</code></pre><p>Prepare recording of impedance results</p><pre><code class="language-julia">    allomega=zeros(0)</code></pre><p>for calculated data</p><pre><code class="language-julia">    allI0=zeros(Complex{Float64},0)
    allIL=zeros(Complex{Float64},0)</code></pre><p>for exact data</p><pre><code class="language-julia">    allIx0=zeros(Complex{Float64},0)
    allIxL=zeros(Complex{Float64},0)

    ω0=0.5
    ω1=1.0e4
    ω=ω0

    testval=0.0
    UZ=unknowns(isys)
    while ω&lt;ω1

        iω=1im*ω</code></pre><p>solve impedance system</p><pre><code class="language-julia">        solve!(UZ,isys,ω)</code></pre><p>calculate aproximate solution</p><pre><code class="language-julia">        I0=integrate(isys,tf0,ω,UZ)[1]
        IL=integrate(isys,tfL,ω,UZ)[1]</code></pre><p>record approximate solution</p><pre><code class="language-julia">        push!(allomega, ω)
        push!(allI0,I0)
        push!(allIL,IL)</code></pre><p>record exact solution</p><pre><code class="language-julia">        z=sqrt(iω*data.C/data.D+data.R/data.D);
        eplus=exp(z*L);
        eminus=exp(-z*L);
        Ix0=-data.D*z*(eminus+eplus)/(eminus-eplus);
        IxL=2.0*data.D*z/(eminus-eplus);
        push!(allIx0,Ix0)
        push!(allIxL,IxL)

        if doplot
            p=Plots.plot(grid.coord[1,:],real(UZ[1,:]),label=&quot;Re&quot;, grid=true)
            Plots.plot!(p,grid.coord[1,:],imag(UZ[1,:]),label=&quot;Im&quot;)
            Plots.gui(p)
        end</code></pre><p>increase omega</p><pre><code class="language-julia">        ω=ω*1.2

    end

    if doplot
        p=plot(grid=true)
        plot!(p,real(allI0),imag(allI0),label=&quot;calc&quot;)
        plot!(p,real(allIx0),imag(allIx0),label=&quot;exact&quot;)
        gui(p)
        readline()

        p=plot(grid=true)
        plot!(p,real(allIL),imag(allIL),label=&quot;calc&quot;)
        plot!(p,real(allIxL),imag(allIxL),label=&quot;exact&quot;)
        gui(p)
        readline()
    end
    #return test value
    return  imag(allIL[5])
end

function test()
    main() ≈ 0.23106605162049176
end


end</code></pre><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../Example125_TestFunctions1D/"><span class="direction">Previous</span><span class="title">125: Terminal flux calculation via test functions</span></a><a class="next" href="../Example160_UnipolarDriftDiffusion1D/"><span class="direction">Next</span><span class="title">160: Unipolar degenerate drift-diffusion</span></a></footer></article></body></html>
